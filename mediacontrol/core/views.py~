from django.shortcuts import render_to_response
from django.template import RequestContext
from django.utils import simplejson
from django.http import HttpResponse, HttpResponseRedirect
from forms import *
from models import *

def index(request):
    return render_to_response('index.html', RequestContext(request, locals()))

def add_solicitud(request):
    flag = 'solicitud'
    return render_to_response('solicitud.html', RequestContext(request, locals()))

def add_persona(request):
    flag = 'persona'
    return render_to_response('solicitud.html', RequestContext(request, locals()))

def add_material(request):
    flag = 'material'
    return render_to_response('solicitud.html', RequestContext(request, locals()))

def add_otros(request):
    flag = 'otros'
    if request.method == 'POST':
        form = ProfesionForm(request.POST)
        if form.is_valid():
            form.save()
            return HttpResponseRedirect('/add/otros/')
    else:
        form = ProfesionForm()
        form_tipo = TipoForm()
        form_tematica = TematicaForm()
    return render_to_response('otros.html', RequestContext(request, locals()))

def add_otros_edit(request, id):
    flag = 'otros'
    pro = Profesion.objects.get(pk=id)
    if request.method == 'POST':
        form = ProfesionForm(request.POST, instance=pro)
        form_tipo = TipoForm()
        form_tematica = TematicaForm()

        if form.is_valid():
            pro.nombre = form.cleaned_data['nombre']
            pro.save()
            return HttpResponseRedirect('/add/otros/')
    else:
        form = ProfesionForm(instance=pro)
        form_tipo = TipoForm()
        form_tematica = TematicaForm()

    return render_to_response('otros_edit_profesion.html', RequestContext(request, locals()))

def add_otros_tematica(request):
    flag = 'otros'
    form = ProfesionForm()
    form_tipo = TipoForm()
    form_tematica = TematicaForm()
    return render_to_response('otros.html', RequestContext(request, locals()))


# Se vienen las vistas que son consultadas por medio de ajax 
def get_profesiones(request):
	profesiones = Profesion.objects.all().order_by('id')
	lista = [(profesion.id, profesion.nombre) for profesion in profesiones]
	return HttpResponse(simplejson.dumps(lista), mimetype='application/javascript')

def del_profesiones(request, id):
	profesion = Profesion.objects.get(pk=int(id))
    profesion.delete()	
	return HttpResponse('Registro Eliminado', mimetype='text/html')

